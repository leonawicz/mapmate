<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Network maps • mapmate</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootswatch/3.3.7/sandstone/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../jquery.sticky-kit.min.js"></script><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<!-- mathjax --><script src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-vignette">
      <header><div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="../index.html">mapmate</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
    Home
  </a>
</li>
<li>
  <a href="../articles/mapmate.html">
    <span class="fa fa-info fa-lg"></span>
     
    Introduction
  </a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fa fa-globe fa-lg"></span>
     
    Visual examples
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/usage_and_limitations.html">Usage &amp; limitations</a>
    </li>
    <li>
      <a href="../articles/networks.html">Network maps</a>
    </li>
  </ul>
</li>
<li>
  <a href="../articles/ffmpeg.html">
    <span class="fa fa-play-circle-o fa-lg"></span>
     
    ffmpeg
  </a>
</li>
<li>
  <a href="../reference/index.html">
    <span class="fa fa-book fa-lg"></span>
     
    Reference
  </a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/leonawicz/mapmate">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9">
    <div class="page-header toc-ignore">
      <h1>Network maps</h1>
            
          </div>

    
    
<div class="contents">
<p><!-- networks.md is generated from networks.Rmd. Please edit that file --></p>
<p>To install the package:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">devtools::<span class="kw">install_github</span>(<span class="st">"leonawicz/mapmate"</span>)</code></pre></div>
<p>The <code>save_map</code> function in the <code>mapmate</code> package offers the <code>type="network"</code> map type. This type of map displays networks or pathways defined by overlapping segments traversing along great circle arcs. This map type can be used to display arbitrary line segments as well if such data is provided, but the provided helper functions used here are aimed specifically at drawing great circles.</p>
<div id="obtain-great-circle-arc-endpoints" class="section level2">
<h2 class="hasAnchor">
<a href="#obtain-great-circle-arc-endpoints" class="anchor"></a>Obtain great circle arc endpoints</h2>
<p>The first example uses a flat map. Therefore it is important to break lines at the international dateline when preparing the data. In the second example, lines cross the dateline are not split because the segments will be plotted on the globe.</p>
<p>First, begin with the <code>network</code> data set provided in <code>mapmate</code> is a simple data frame of lon/lat locations of various cities and corresponding weights related to population sizes. It must be expanded to a larger, more complex data frame that contains location pairs and, optionally, distances between locations in each pair. <code>gc_endpoints</code> assists with this by simulating some pairs. The resulting data frame contains endpoints of lines that are defined subsequently.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(mapmate)
<span class="kw">library</span>(dplyr)

<span class="kw">set.seed</span>(<span class="dv">192</span>)
<span class="kw">data</span>(network)
network

distFun &lt;-<span class="st"> </span>function(x) <span class="dv">1</span> -<span class="st"> </span>x/<span class="kw">max</span>(x)  <span class="co"># simple inverse distance weighting</span>
endpoints &lt;-<span class="st"> </span><span class="kw"><a href="../reference/gc_endpoints.html">gc_endpoints</a></span>(network, <span class="st">"lon"</span>, <span class="st">"lat"</span>)
endpoints</code></pre></div>
</div>
<div id="obtain-great-circle-arcs" class="section level2">
<h2 class="hasAnchor">
<a href="#obtain-great-circle-arcs" class="anchor"></a>Obtain great circle arcs</h2>
<p>Next, we sample based on a combination of weights. This is an arbitrary and optional step. The example is given primarily to make the data set used in these examples smaller in size. More importantly, the <code>gc_arcs</code> helper function is used to further expand the <code>endpoints</code> data frame to one containing sequences of points describing great circle arcs instead of only their endpoints.</p>
<p>The default number of points added between the endpoints of each great circle arc is <code>n=50</code>, but this can be changed and can also differ for each arc (e.g., based on distance between points). As noted, arcs are filled out planning for use with both flat maps and a globes. A <code>group</code> column is used to identify distinct arcs for plotting.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># take a weighted sample, e.g., favoring larger averaged populations and</span>
<span class="co"># shorter distances</span>
endpoints &lt;-<span class="st"> </span><span class="kw">mutate</span>(endpoints, <span class="dt">Dist_wts =</span> <span class="kw">distFun</span>(Dist))
endpoints &lt;-<span class="st"> </span><span class="kw">sample_n</span>(endpoints, <span class="dv">500</span>, <span class="dt">replace =</span> <span class="ot">TRUE</span>, <span class="dt">weight =</span> (Pop_wts0 +<span class="st"> </span>Pop_wts1)/<span class="dv">2</span> +<span class="st"> </span>
<span class="st">    </span>Dist_wts)

<span class="co"># expand data frame from endpoints to arcs, each composed of a sequence of</span>
<span class="co"># points</span>
arcs_flat &lt;-<span class="st"> </span><span class="kw"><a href="../reference/gc_arcs.html">gc_arcs</a></span>(endpoints, <span class="st">"lon0"</span>, <span class="st">"lat0"</span>, <span class="st">"lon1"</span>, <span class="st">"lat1"</span>, <span class="dt">breakAtDateLine =</span> <span class="ot">TRUE</span>)
arcs_globe &lt;-<span class="st"> </span><span class="kw"><a href="../reference/gc_arcs.html">gc_arcs</a></span>(endpoints, <span class="st">"lon0"</span>, <span class="st">"lat0"</span>, <span class="st">"lon1"</span>, <span class="st">"lat1"</span>)
arcs_globe</code></pre></div>
</div>
<div id="obtain-great-circle-arc-path-sequences" class="section level2">
<h2 class="hasAnchor">
<a href="#obtain-great-circle-arc-path-sequences" class="anchor"></a>Obtain great circle arc path sequences</h2>
<p>Finally, <code>gc_paths</code> is used to further expand the great circle arcs data frame into one that contains sequences of ordered segments along each arc. The segments can vary in length between distinct arcs and can overlap one another within an arc. The <code>group</code> argument is required to identify distinct arcs in the input data frame. <code>size</code> is required to set an upper limit on the number of points constituting an arc segment; the actual length of the segments is chosen randomly and uniformly between 2 and <code>size</code>. Other arguments are optional.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">paths_flat &lt;-<span class="st"> </span><span class="kw"><a href="../reference/gc_paths.html">gc_paths</a></span>(arcs_flat, <span class="st">"group"</span>, <span class="dt">size =</span> <span class="dv">5</span>)
paths_globe &lt;-<span class="st"> </span><span class="kw"><a href="../reference/gc_paths.html">gc_paths</a></span>(arcs_globe, <span class="st">"group"</span>, <span class="dt">size =</span> <span class="dv">5</span>)
paths_globe</code></pre></div>
</div>
<div id="flat-map-network-animation" class="section level1">
<h1 class="hasAnchor">
<a href="#flat-map-network-animation" class="anchor"></a>Flat map network animation</h1>
<p>The direction of arc traversal can also be controlled by the <code>direction</code> argument if desired. This is useful for simulations if the input data are not yet randomized or if the directions simply need to be reversed. First some setup:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">n &lt;-<span class="st"> </span><span class="kw">max</span>(paths_flat$id)
png.args &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">width =</span> <span class="dv">600</span>, <span class="dt">height =</span> <span class="dv">300</span>, <span class="dt">bg =</span> <span class="st">"black"</span>)
clrs &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">"#1E90FF50"</span>, <span class="st">"#FFFFFF50"</span>, <span class="st">"#FFFFFF"</span>, <span class="st">"#1E90FF75"</span>)
ylm &lt;-<span class="st"> </span><span class="kw">range</span>(paths_flat$lat)  <span class="co"># trimming empty southern map region</span></code></pre></div>
<p>Typically, I would leave the default arguments <code>save.plot=TRUE</code> and <code>return.plot=FALSE</code>, but here they are reversed for the purposes of the example. This returns a list of <code>ggplot</code> objects rather than saving png files. Note that I still included the <code>png.args</code> argument even though <code>width</code> and <code>height</code> will be discarded because <code>save_map</code> will take the background color specified by <code>bg</code> intended for png files and use it in the <code>ggplot2</code> theme applied to the returned plots.</p>
<p>The default background is transparent so I need to include this here since I have changed it to black. I have changed it to black in this example because I am making a reproducible gif for simplicity rather than doing any layering of separate image sequences in a video editor. Below, <code>saveGIF</code> from the <code>animation</code> package is used to make a simple gif from the plot sequence produced by <code>save_map</code> by looping over the list of returned plots.</p>
<p>In summary, this is all a somewhat convoluted scenario to show you a short animated gif representing plots made by <code>save_map</code>. The intended use case for <code>save_map</code> is to simply export the sequence of png files and the user can do whatever they wish with those files subsequently. If literally all you want to do is make a short, simple animated gif of custom plots using a small amount of data, <em>just use the animation package</em>. You do not need <code>mapmate</code> for that. Also, if you are using <code>animation</code> in general, as with the code below, it is dependent on <code>ImageMagick</code>, which you will also have to install.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">gglist &lt;-<span class="st"> </span><span class="kw"><a href="../reference/save_seq.html">save_seq</a></span>(paths_flat, <span class="dt">id =</span> <span class="st">"id"</span>, <span class="dt">n.frames =</span> n, <span class="dt">ortho =</span> <span class="ot">FALSE</span>, <span class="dt">type =</span> <span class="st">"network"</span>, 
    <span class="dt">ylim =</span> ylm, <span class="dt">png.args =</span> png.args, <span class="dt">save.plot =</span> <span class="ot">FALSE</span>, <span class="dt">return.plot =</span> <span class="ot">TRUE</span>)

<span class="kw">library</span>(animation)
<span class="co"># you may need to specify a different path on your Windows machine you may</span>
<span class="co"># also need to ensure convert.exe is part of your particular installation</span>
<span class="kw">ani.options</span>(<span class="dt">convert =</span> <span class="st">"C:/Progra~1/ImageMagick-7.0.6-Q16/convert.exe"</span>)
<span class="kw">saveGIF</span>({
    for (i in <span class="kw">seq_along</span>(gglist)) <span class="kw">print</span>(gglist[[i]])
}, <span class="st">"network2D.gif"</span>, <span class="dt">interval =</span> <span class="dv">1</span>/<span class="dv">20</span>, <span class="dt">ani.width =</span> <span class="dv">960</span>, <span class="dt">ani.height =</span> <span class="dv">480</span>)</code></pre></div>
<p style="text-align:center;">
<img src="network2D.gif"></p>
<p>This <code>animation</code>-dependent example and the animated gif are not meant to be distractions from the purpose of this package. Despite the example gif, any code here related to <code>animation</code> is beyond the scope of this tutorial. If you have trouble running it, see the <code>animation</code> documentation and just do the following example instead, which is the way <code>mapmate</code> is meant to be used:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/save_seq.html">save_seq</a></span>(paths_flat, <span class="dt">id =</span> <span class="st">"id"</span>, <span class="dt">n.frames =</span> n, <span class="dt">ortho =</span> <span class="ot">FALSE</span>, <span class="dt">type =</span> <span class="st">"network"</span>, 
    <span class="dt">file =</span> <span class="st">"network2D"</span>, <span class="dt">png.args =</span> png.args)
<span class="co"># Next, do whatever you want with the files, such as import them to a video</span>
<span class="co"># editing program</span></code></pre></div>
</div>
<div id="globe-network-animation" class="section level1">
<h1 class="hasAnchor">
<a href="#globe-network-animation" class="anchor"></a>Globe network animation</h1>
<p>Here is an example plotting network paths along great circle arcs on the globe. Remember that we use the other data set, which was generated with the default <code>breakAtDateline=FALSE</code> in <code>gc_arcs</code>. As a side note, if you redo the above example for flat maps using the unbroken data, <code>paths_globe</code>, you will see why the arc segments are handled differently when preparing data for flat maps vs. for globes.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">n &lt;-<span class="st"> </span><span class="kw">max</span>(paths_globe$id)
png.args &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">width =</span> <span class="dv">600</span>, <span class="dt">height =</span> <span class="dv">600</span>, <span class="dt">bg =</span> <span class="st">"black"</span>)
clrs &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">"#FFFFFF"</span>, <span class="st">"#FF450050"</span>, <span class="st">"#FF4500"</span>, <span class="st">"#FFFFFF50"</span>)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">gglist &lt;-<span class="st"> </span><span class="kw"><a href="../reference/save_seq.html">save_seq</a></span>(paths_globe, <span class="dt">id =</span> <span class="st">"id"</span>, <span class="dt">n.frames =</span> n, <span class="dt">col =</span> clrs, <span class="dt">type =</span> <span class="st">"network"</span>, 
    <span class="dt">pt.size =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">2</span>), <span class="dt">png.args =</span> png.args, <span class="dt">save.plot =</span> <span class="ot">FALSE</span>, <span class="dt">return.plot =</span> <span class="ot">TRUE</span>)

<span class="kw">library</span>(animation)
<span class="kw">ani.options</span>(<span class="dt">convert =</span> <span class="st">"C:/Progra~1/ImageMagick-7.0.3-Q16/convert.exe"</span>)
<span class="kw">saveGIF</span>({
    for (i in <span class="kw">seq_along</span>(gglist)) <span class="kw">print</span>(gglist[[i]])
}, <span class="st">"network3D.gif"</span>, <span class="dt">interval =</span> <span class="dv">1</span>/<span class="dv">20</span>, <span class="dt">ani.width =</span> <span class="dv">600</span>, <span class="dt">ani.height =</span> <span class="dv">600</span>)</code></pre></div>
<p style="text-align:center;">
<img src="network3D.gif"></p>
<p>Again, normal usage is to just do the following and then use the saved still image sequence with full user control for whatever you like:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/save_seq.html">save_seq</a></span>(paths_globe, <span class="dt">id =</span> <span class="st">"id"</span>, <span class="dt">n.frames =</span> n, <span class="dt">col =</span> clrs, <span class="dt">type =</span> <span class="st">"network"</span>, 
    <span class="dt">pt.size =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">2</span>), <span class="dt">file =</span> <span class="st">"network3D"</span>, <span class="dt">png.args =</span> png.args)</code></pre></div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#obtain-great-circle-arc-endpoints">Obtain great circle arc endpoints</a></li>
      <li><a href="#obtain-great-circle-arcs">Obtain great circle arcs</a></li>
      <li><a href="#obtain-great-circle-arc-path-sequences">Obtain great circle arc path sequences</a></li>
      <li><a href="#flat-map-network-animation">Flat map network animation</a></li>
      <li><a href="#globe-network-animation">Globe network animation</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Matthew Leonawicz.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://hadley.github.io/pkgdown/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  </body>
</html>
